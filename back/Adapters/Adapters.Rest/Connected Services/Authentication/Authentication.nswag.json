{
	"openapi": "3.0.1",
	"info": {
		"title": "Authentication.Api.Web",
		"version": "1.0"
	},
	"paths": {
		"/api/auth/{username}/register/finalize": {
			"post": {
				"tags": [
					"Authentication"
				],
				"summary": "Final register step",
				"operationId": "Register",
				"parameters": [
					{
						"name": "username",
						"in": "path",
						"required": true,
						"description": "",
						"schema": {
							"type": "string"
						}
					}
				],
				"requestBody": {
					"description": "user's password hashed with salt",
					"content": {
						"application/json": {
							"schema": {
								"type": "string"
							}
						},
						"text/json": {
							"schema": {
								"type": "string"
							}
						},
						"application/*+json": {
							"schema": {
								"type": "string"
							}
						}
					},
					"required": true
				},
				"responses": {
					"201": {
						"description": "Created",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/User"
								}
							},
							"text/json": {
								"schema": {
									"$ref": "#/components/schemas/User"
								}
							}
						}
					}
				}
			}
		},
		"/api/auth/{username}/register/init": {
			"post": {
				"tags": [
					"Authentication"
				],
				"summary": "First register step",
				"operationId": "InitRegister",
				"parameters": [
					{
						"name": "username",
						"in": "path",
						"required": true,
						"description": "",
						"schema": {
							"type": "string"
						}
					}
				],
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/InitRegisterResponse"
								}
							},
							"text/json": {
								"schema": {
									"$ref": "#/components/schemas/InitRegisterResponse"
								}
							}
						}
					}
				}
			}
		},
		"/api/auth/{username}/password/finalize": {
			"put": {
				"tags": [
					"Authentication"
				],
				"summary": "Change user's password",
				"operationId": "ChangePassword",
				"parameters": [
					{
						"name": "username",
						"in": "path",
						"required": true,
						"description": "",
						"schema": {
							"type": "string"
						}
					}
				],
				"requestBody": {
					"description": "user's password hashed with salt",
					"content": {
						"application/json": {
							"schema": {
								"type": "string"
							}
						},
						"text/json": {
							"schema": {
								"type": "string"
							}
						},
						"application/*+json": {
							"schema": {
								"type": "string"
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "No Content"
					}
				}
			}
		},
		"/api/auth/{username}/password/init": {
			"put": {
				"tags": [
					"Authentication"
				],
				"summary": "First step to change user's password",
				"operationId": "InitChangePassword",
				"parameters": [
					{
						"name": "username",
						"in": "path",
						"required": true,
						"description": "",
						"schema": {
							"type": "string"
						}
					}
				],
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/InitRegisterResponse"
								}
							},
							"text/json": {
								"schema": {
									"$ref": "#/components/schemas/InitRegisterResponse"
								}
							}
						}
					}
				}
			}
		},
		"/api/auth/{username}/login/finalize": {
			"post": {
				"tags": [
					"Authentication"
				],
				"summary": "Final login step",
				"operationId": "Login",
				"parameters": [
					{
						"name": "username",
						"in": "path",
						"required": true,
						"description": "",
						"schema": {
							"type": "string"
						}
					}
				],
				"requestBody": {
					"description": "",
					"content": {
						"application/json": {
							"schema": {
								"type": "string"
							}
						},
						"text/json": {
							"schema": {
								"type": "string"
							}
						},
						"application/*+json": {
							"schema": {
								"type": "string"
							}
						}
					},
					"required": true
				},
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"type": "string"
								}
							},
							"text/json": {
								"schema": {
									"type": "string"
								}
							}
						}
					}
				}
			}
		},
		"/api/auth/{username}/login/init": {
			"post": {
				"tags": [
					"Authentication"
				],
				"summary": "First login step",
				"operationId": "InitLogin",
				"parameters": [
					{
						"name": "username",
						"in": "path",
						"required": true,
						"description": "",
						"schema": {
							"type": "string"
						}
					}
				],
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/InitVerifyResponse"
								}
							},
							"text/json": {
								"schema": {
									"$ref": "#/components/schemas/InitVerifyResponse"
								}
							}
						}
					}
				}
			}
		},
		"/api/jwt/verify": {
			"get": {
				"tags": [
					"Jwt"
				],
				"summary": "Verify if Jwt is still valid",
				"operationId": "Verify",
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"type": "boolean"
								}
							},
							"text/json": {
								"schema": {
									"type": "boolean"
								}
							}
						}
					}
				}
			}
		},
		"/api/jwt/validation-key": {
			"get": {
				"tags": [
					"Jwt"
				],
				"summary": "Get public RSA key used for Jwt validation",
				"operationId": "GetValidationKey",
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/StringResponse"
								}
							},
							"text/json": {
								"schema": {
									"$ref": "#/components/schemas/StringResponse"
								}
							}
						}
					}
				}
			}
		},
		"/api/jwt/refresh": {
			"post": {
				"tags": [
					"Jwt"
				],
				"summary": "Refresh a JWT",
				"operationId": "RefreshJwt",
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/StringResponse"
								}
							},
							"text/json": {
								"schema": {
									"$ref": "#/components/schemas/StringResponse"
								}
							}
						}
					}
				}
			}
		},
		"/api/users/{id}": {
			"get": {
				"tags": [
					"Users"
				],
				"summary": "Get a specific user",
				"operationId": "Get",
				"parameters": [
					{
						"name": "id",
						"in": "path",
						"required": true,
						"description": "",
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					}
				],
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/User"
								}
							},
							"text/json": {
								"schema": {
									"$ref": "#/components/schemas/User"
								}
							}
						}
					}
				}
			},
			"put": {
				"tags": [
					"Users"
				],
				"summary": "Update an user",
				"operationId": "UpdateUser",
				"parameters": [
					{
						"name": "id",
						"in": "path",
						"required": true,
						"description": "",
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					}
				],
				"requestBody": {
					"description": "",
					"content": {
						"application/json": {
							"schema": {
								"allOf": [
									{
										"$ref": "#/components/schemas/User"
									}
								]
							}
						},
						"text/json": {
							"schema": {
								"allOf": [
									{
										"$ref": "#/components/schemas/User"
									}
								]
							}
						},
						"application/*+json": {
							"schema": {
								"allOf": [
									{
										"$ref": "#/components/schemas/User"
									}
								]
							}
						}
					},
					"required": true
				},
				"responses": {
					"204": {
						"description": "No Content"
					}
				}
			},
			"delete": {
				"tags": [
					"Users"
				],
				"summary": "Delete an user",
				"operationId": "DeleteUser",
				"parameters": [
					{
						"name": "id",
						"in": "path",
						"required": true,
						"description": "",
						"schema": {
							"type": "string",
							"format": "uuid"
						}
					}
				],
				"responses": {
					"204": {
						"description": "No Content"
					}
				}
			}
		},
		"/api/users": {
			"get": {
				"tags": [
					"Users"
				],
				"summary": "Get all users",
				"operationId": "GetAll",
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"type": "array",
									"items": {
										"$ref": "#/components/schemas/User"
									}
								}
							},
							"text/json": {
								"schema": {
									"type": "array",
									"items": {
										"$ref": "#/components/schemas/User"
									}
								}
							}
						}
					}
				}
			}
		},
		"/api/users/any": {
			"get": {
				"tags": [
					"Users"
				],
				"summary": "Get if there is at least one user in database",
				"operationId": "CheckIfUsersExist",
				"responses": {
					"200": {
						"description": "Success",
						"content": {
							"application/json": {
								"schema": {
									"type": "boolean"
								}
							},
							"text/json": {
								"schema": {
									"type": "boolean"
								}
							}
						}
					}
				}
			}
		}
	},
	"components": {
		"schemas": {
			"Authentication": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"roles"
				],
				"properties": {
					"roles": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/AuthenticationRoles"
						}
					}
				}
			},
			"AuthenticationRoles": {
				"type": "string",
				"enum": [
					"User",
					"Admin"
				]
			},
			"Authorizations": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"authentication"
				],
				"properties": {
					"authentication": {
						"allOf": [
							{
								"$ref": "#/components/schemas/Authentication"
							}
						]
					},
					"videyo": {
						"nullable": true,
						"allOf": [
							{
								"$ref": "#/components/schemas/Videyo"
							}
						]
					},
					"sousMarinJaune": {
						"nullable": true,
						"allOf": [
							{
								"$ref": "#/components/schemas/SousMarinJaune"
							}
						]
					},
					"backupMaker": {
						"nullable": true,
						"allOf": [
							{
								"$ref": "#/components/schemas/BackupMaker"
							}
						]
					}
				}
			},
			"BackupMaker": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"roles"
				],
				"properties": {
					"roles": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/BackupMakerRole"
						}
					}
				}
			},
			"BackupMakerRole": {
				"type": "string",
				"enum": [
					"Admin"
				]
			},
			"Credentials": {
				"type": "object",
				"additionalProperties": false,
				"properties": {
					"github": {
						"nullable": true,
						"allOf": [
							{
								"$ref": "#/components/schemas/Github"
							}
						]
					},
					"docker": {
						"nullable": true,
						"allOf": [
							{
								"$ref": "#/components/schemas/Docker"
							}
						]
					}
				}
			},
			"Docker": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"username",
					"password"
				],
				"properties": {
					"username": {
						"type": "string"
					},
					"password": {
						"type": "string"
					}
				}
			},
			"Github": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"token",
					"user"
				],
				"properties": {
					"token": {
						"type": "string"
					},
					"user": {
						"type": "string"
					}
				}
			},
			"InitRegisterResponse": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"salt"
				],
				"properties": {
					"salt": {
						"type": "string"
					}
				}
			},
			"InitVerifyResponse": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"salt",
					"challenge"
				],
				"properties": {
					"salt": {
						"type": "string"
					},
					"challenge": {
						"type": "string"
					}
				}
			},
			"ObjectId": {
				"type": "object",
				"additionalProperties": false,
				"properties": {
					"timestamp": {
						"type": "integer",
						"readOnly": true,
						"format": "int32"
					},
					"machine": {
						"type": "integer",
						"readOnly": true,
						"format": "int32",
						"deprecated": true
					},
					"pid": {
						"type": "integer",
						"readOnly": true,
						"format": "int32",
						"deprecated": true
					},
					"increment": {
						"type": "integer",
						"readOnly": true,
						"format": "int32",
						"deprecated": true
					},
					"creationTime": {
						"type": "string",
						"readOnly": true,
						"format": "date-time"
					}
				}
			},
			"Settings": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"theme"
				],
				"properties": {
					"theme": {
						"allOf": [
							{
								"$ref": "#/components/schemas/SettingsType"
							}
						]
					}
				}
			},
			"SettingsType": {
				"type": "string",
				"enum": [
					"Dark",
					"Light",
					"System"
				]
			},
			"SousMarinJaune": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"roles"
				],
				"properties": {
					"roles": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/SousMarinJauneRole"
						}
					}
				}
			},
			"SousMarinJauneRole": {
				"type": "string",
				"enum": [
					"Admin",
					"User"
				]
			},
			"StringResponse": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"data"
				],
				"properties": {
					"data": {
						"type": "string"
					}
				}
			},
			"User": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"id",
					"createdAt"
				],
				"properties": {
					"id": {
						"type": "string",
						"format": "uuid"
					},
					"createdAt": {
						"type": "string",
						"format": "date-time"
					}
				},
				"allOf": [
					{
						"$ref": "#/components/schemas/UserBase"
					}
				]
			},
			"UserBase": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"username",
					"settings",
					"credentials",
					"authorizations",
					"disabled"
				],
				"properties": {
					"username": {
						"type": "string"
					},
					"hash": {
						"type": "string",
						"nullable": true
					},
					"salt": {
						"type": "string",
						"nullable": true
					},
					"settings": {
						"allOf": [
							{
								"$ref": "#/components/schemas/Settings"
							}
						]
					},
					"credentials": {
						"allOf": [
							{
								"$ref": "#/components/schemas/Credentials"
							}
						]
					},
					"authorizations": {
						"allOf": [
							{
								"$ref": "#/components/schemas/Authorizations"
							}
						]
					},
					"lastConnection": {
						"type": "string",
						"format": "date-time",
						"nullable": true
					},
					"disabled": {
						"type": "boolean"
					}
				}
			},
			"UserEntity": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"id"
				],
				"properties": {
					"id": {
						"allOf": [
							{
								"$ref": "#/components/schemas/ObjectId"
							}
						]
					}
				},
				"allOf": [
					{
						"$ref": "#/components/schemas/UserBase"
					}
				]
			},
			"Videyo": {
				"type": "object",
				"additionalProperties": false,
				"required": [
					"roles"
				],
				"properties": {
					"roles": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/VideyoRole"
						}
					}
				}
			},
			"VideyoRole": {
				"type": "string",
				"enum": [
					"User",
					"Admin"
				]
			}
		}
	}
}